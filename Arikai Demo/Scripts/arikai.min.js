/*
tekpot Pivot v1.3.1 - Javascript Pivot like report generator
(c) 2012 BalaSM <https://sites.google.com/site/niralaakkam/>
Demo : http://aspspider.org/balasm06
MIT-style license.
NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.
Please dont DELETE this header
Author : BalaSM	

Addressed in Release 1.3
1. Edit Layout Cancel button collapse the Filter Layout Dialog option.
2. Changed CSS for usablity and readability

Addresses in Release 1.3.1
1. Configurable variable for showing Sub Total and Grand Total by intorducing Variables
    Arikai.ShowSubTotal = true / false; // Default - true
    Arikai.ShowGrandTotal = true / false; // Default - true
2. Configurable variable for Empty Cell Value
    Arikai.EmptyCellValue = "None"; // Default - 0

If any body interested, can change the CSS and share it to all.

*/
var DataType={Integer:0,Decimal:1,Amount:2};var DecimalPoint={None:0,One:1,Two:2,Three:3,Four:4};function Arikai(){var fieldSptr=",";var DECIMALPOINTS=0;var months=["January","February","March","April","May","June","July","August","September","October","November","December"];var days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var colList="";var rowList="";var optionList="";var funList="";var filterList="";var reportHeader="";var aggFunDataType;var container="";var colValueList={};var rowValueList={};var aggFun;var aggField;var aggFunLower;var IsChanged=false;var emptyCellValue;var amountSymbol="";var ColHeaderFields;var RowHeaderFields;var that=this;this.ColulmnAreaFields="";this.RowAreaFields="";this.DataAreaField="";this.DataDisplayType=DataType.Integer;this.CustomDecimalPoint=DecimalPoint.None;this.OptionFields="";this.ReportTitle="";this.ReportData=null;this.ContainerElementId="";this.EmptyCellValue=0;this.IsLayoutEditable=true;this.IsDataFilterable=true;this.ShowSubTotal=true;this.ShowGrandTotal=true;var ResultAgg={};var ColumnFilterList={};var RowFilterList={};var Init=function(){aggFun=funList.split("(")[0];aggField=funList.substr(funList.indexOf("(")+1).replace(")","");if(DECIMALPOINTS==0){SetDecimalPoints()}};this.Start=function(){if(!IsChanged){colList=that.ColulmnAreaFields;rowList=that.RowAreaFields;funList=that.DataAreaField;aggFunDataType=that.DataDisplayType;DECIMALPOINTS=that.CustomDecimalPoint;optionList=that.OptionFields;reportHeader=that.ReportTitle;reportData=that.ReportData;container=that.ContainerElementId;emptyCellValue=that.EmptyCellValue}IsChanged=false;Init();try{if(container==null||container==undefined||container==""){throw ('Please pass valid</span> <span class="ErrorHighLight">Container Element Id');return false}if(that.ReportData==null||that.ReportData==undefined){throw ('Please pass valid </span> <span class="ErrorHighLight"> Data object');return false}else{if(!$.isArray(that.ReportData)&&that.ReportData.length>0){throw ('Please pass valid </span> <span class="ErrorHighLight"> Data.</span> <span>Report Data should be in the object array format. Please refer help document for more details.');return false}else{var fieldNames=rowList+fieldSptr+colList;var fields=fieldNames.split(fieldSptr);var ite=0;var ReportDataLength=that.ReportData.length;do{var found=false;for(var i=0;i<ReportDataLength;i++){var reportItem=that.ReportData[i];if(fields[ite] in reportItem){found=true;break}}if(!found){ErrorDialog(container,true,'Field - </span><span class="ErrorHighligh">'+fields[ite]+"</span> <span>not found in the result set");return false}ite++}while(ite<fields.length)}}setTimeout(function(){that.LoadingProgress(container,true)},10);$("#"+container).addClass("Container");try{setTimeout(function(){DataAggregate();if(that.ShowSubTotal==false){$("#report").find("TR TD.SubAgg").hide()}if(that.ShowGrandTotal==false){$("#report").find(".GrandAgg, .Header-GrandAgg").hide()}},1);$("#"+container).find("#reportHeader").remove().end().append($("<div id='reportHeader'>"+reportHeader+"</div>"))}catch(e){throw (e)}}catch(e){ErrorDialog(container,true,e)}};var SetDecimalPoints=function(){switch(aggFunDataType){case DataType.Integer:DECIMALPOINTS=0;break;case DataType.Decimal:if(DECIMALPOINTS==0){DECIMALPOINTS=2}else{DECIMALPOINTS=DECIMALPOINTS}break;case DataType.Amount:DECIMALPOINTS=2;break;case DataType.Date:DECIMALPOINTS=0;break;default:DECIMALPOINTS=0;break}};function parseJsonDate(jsonDate){var offset=new Date().getTimezoneOffset()*60000;var parts=/\/Date\((-?\d+)([+-]\d{2})?(\d{2})?.*/.exec(jsonDate);if(parts[2]==undefined){parts[2]=0}if(parts[3]==undefined){parts[3]=0}return new Date(+parts[1]+offset+parts[2]*3600000+parts[3]*60000)}var FormatData=function(data){if(aggFunDataType==DataType.Date){return Data}else{if(data==emptyCellValue){return data}return data.toFixed(DECIMALPOINTS)}};var FilterItem=function(item){if(filterList!==undefined&&eval(ParseFilter(filterList))==false){return false}return true};var FilterKey=function(key,FilterList){var keySplit=key.split("--");for(var i in keySplit){var tempArr=keySplit[i].split("~~");if(IsExistInArray(FilterList[tempArr[0]],tempArr[1])){continue}else{return false}}return true};var GetSpan=function(TempGroup,isCol){var keys=TempGroup.sortKeys();var SpanGroup=new HashTable();var TD=document.createElement("TD");for(var key in keys){var thisKey=keys[key];var span=0;var td=null;if(!isCol){if(FilterKey(thisKey,RowFilterList)){for(var Subkey in keys){if(FilterKey(keys[Subkey],RowFilterList)){if(keys[Subkey].indexOf(thisKey)==0){span++}}}var fieldValue=thisKey.split("--");if(span>1||fieldValue.length==rowList.split(",").length){fieldValue=fieldValue[fieldValue.length-1];td=TD.cloneNode();td.setAttribute("rowspan",span);td.setAttribute("class","Header-Row");td.setAttribute("rvalue",""+thisKey+"");td.innerHTML=fieldValue.split("~~")[1]}}else{continue}}else{if(FilterKey(thisKey,ColumnFilterList)){var times=1;var temp=0;var td=null;var prevKey=keys[key];for(var Subkey in keys){var sKey=keys[Subkey];if(FilterKey(sKey,ColumnFilterList)){if(sKey.indexOf(thisKey)==0&&sKey!=thisKey){temp=sKey.split("--").length;if(sKey.indexOf(prevKey)!=0&&prevKey!=sKey){times++}}prevKey=sKey}}var fieldValue=thisKey.split("--");if(fieldValue.length==colList.split(",").length||(temp==colList.split(",").length)){span=times;fieldValue=fieldValue[fieldValue.length-1];td=TD.cloneNode();td.setAttribute("colspan",span);td.setAttribute("class","Header-Column");td.setAttribute("cvalue","rvalue**"+thisKey+"");td.innerHTML=fieldValue.split("~~")[1]}}else{continue}}if(td!==undefined&&td!=null){SpanGroup.setItem(thisKey,td)}}return SpanGroup};var DataAggregate=function(){var ColSpanGroup=new HashTable();var RowSpanGroup=new HashTable();var list=that.ReportData;var fieldNames=rowList+fieldSptr+colList;var fields=fieldNames.split(fieldSptr);var name=fields[0];var fieldLength=fields.length;ResultAgg={};aggFunLower=aggFun.toLowerCase();var groups=new Array();var groupsCount=new Array();var count=0;for(var index in list){var item=list[index];var keyString="";var RowKeyString="";var ColKeyString="";var fieldKey=0;count=0;do{var isDate=false;var name=fields[fieldKey];var fieldValue="";if(name.indexOf("(")>=0){isDate=true;field=name.split("(")[1].replace(")","");if(!item[field]){fieldValue="Blank"}else{var dt=parseJsonDate(item[field]);var nameLowerCase=name.toLowerCase();if(nameLowerCase.indexOf("year(")!=-1){fieldValue=dt.getFullYear().toString()}else{if(nameLowerCase.indexOf("month(")!=-1){fieldValue=dt.getMonth().toString()}else{if(nameLowerCase.indexOf("day(")!=-1){fieldValue=dt.getDay().toString()}}}}}else{name=fields[fieldKey];if(!item[name]){fieldValue="Blank"}else{fieldValue=item[name].toString()}}if(item.Count){count=item.Count}else{if(item[aggField]){count=1}}fieldValue=fieldValue.replace("'"," ");if(colList.indexOf(name)==0){keyString+=keyString==""?name+"~~"+fieldValue:"**"+name+"~~"+fieldValue}else{keyString+=keyString==""?name+"~~"+fieldValue:"--"+name+"~~"+fieldValue}if(colList.indexOf(name)<0){RowKeyString+=RowKeyString==""?name+"~~"+fieldValue:"--"+name+"~~"+fieldValue;RowSpanGroup.items[RowKeyString]=0;if(!rowValueList[name]){rowValueList[name]=new Array()}if(!IsExistInArray(rowValueList[name],fieldValue)){rowValueList[name].push(fieldValue)}}if(colList.indexOf(name)>=0){ColKeyString+=ColKeyString==""?name+"~~"+fieldValue:"--"+name+"~~"+fieldValue;ColSpanGroup.items[ColKeyString]=ColKeyString.split("--").length;if(!colValueList[name]){colValueList[name]=new Array()}if(!IsExistInArray(colValueList[name],fieldValue)){colValueList[name].push(fieldValue)}}fieldKey++}while(fieldKey<fieldLength);var val=item[aggField];if(val==undefined){val="0"}if(groups[keyString]){var preVal=groups[keyString];var preCount=groupsCount[keyString];groupsCount[keyString]=preCount+parseInt(count);try{switch(aggFunLower){case"sum":if(isNaN(val)){throw (aggField+" field having non numeric value.")}preVal=parseFloat(preVal)+parseFloat(val);break;case"max":if(isNaN(val)){preVal=preVal<val?val:preVal}else{preVal=parseFloat(preVal)<parseFloat(val)?parseFloat(val):parseFloat(preVal)}break;case"min":if(isNaN(val)){preVal=preVal>val?val:preVal}else{preVal=parseFloat(preVal)>parseFloat(val)?parseFloat(val):parseFloat(preVal)}break;case"avg":if(isNaN(val)){throw (aggField+" field having non numeric value.")}preVal=parseFloat(preVal)+parseFloat(val);break;case"count":if(val!=null&&isNumeric(preVal)){preVal=preVal+1}break}}catch(e){ErrorDialog(container,true,e)}groups[keyString]=preVal}else{if(!isNaN(val)){val=parseFloat(val)}groups[keyString]=val;groupsCount[keyString]=parseInt(count)}}RowFilterList=clone(rowValueList);ColumnFilterList=clone(colValueList);ResultAgg.Groups=groups;ResultAgg.GroupsCount=groupsCount;ResultAgg.GroupRowSpan=clone(RowSpanGroup);ResultAgg.GroupColSpan=clone(ColSpanGroup);RowSpanGroup=GetSpan(RowSpanGroup,false);ColSpanGroup=GetSpan(ColSpanGroup,true);try{var containerDom=document.getElementById(container);var table=containerDom.getElementsByTagName("table");if(table.length){containerDom.removeChild(table[0])}CreateTableHeaders(ColSpanGroup,RowSpanGroup)}catch(e){throw (e)}try{setTimeout(function(){FillDataCells(ResultAgg);that.LoadingProgress(container,false)},1)}catch(e){throw (e)}return ResultAgg};var IsExistInArray=function(arr,value){if(arr===undefined){return false}else{var temp=arr.join(",");temp=","+temp+",";value=","+value+",";if(temp.indexOf(value)!=-1){return true}}return false};function isNumeric(n){return !isNaN(parseFloat(n))&&isFinite(n)}var CreateTableHeaders=function(ColSpanGroup,RowSpanGroup){var noOfHeaderRows=colList.split(fieldSptr).length;var rowColumnHeaderCount=rowList.split(fieldSptr).length;var table=document.createElement("table");table.setAttribute("class","ReportTable");var tbody=document.createElement("tbody");var TR=document.createElement("TR");var TD=document.createElement("TD");var rowFields=rowList.split(fieldSptr);var trs=new Array(noOfHeaderRows);for(var i=0;i<noOfHeaderRows;i++){trs[i]=TR.cloneNode();if(i==noOfHeaderRows-1){for(var j in rowFields){var td=TD.cloneNode();td.innerHTML=rowFields[j];td.setAttribute("class","Header");trs[i].appendChild(td)}}else{var td=TD.cloneNode();td.innerHTML="";td.setAttribute("class","Header");td.setAttribute("colspan",rowColumnHeaderCount);trs[i].appendChild(td)}tbody.appendChild(trs[i])}trs=tbody.childNodes;var keys=ColSpanGroup.sortKeys();for(var key in keys){var keyValue=keys[key];var rowid=keyValue.split("--").length-1;var element=ColSpanGroup.items[keyValue];var tr=trs[rowid];tr.appendChild(element)}for(var i=0;i<noOfHeaderRows;i++){var td=TD.cloneNode();td.setAttribute("class","Header-GrandAgg");td.setAttribute("cvalue","rvalue");td.innerHTML="";trs[i].appendChild(td);if(i==noOfHeaderRows-1){td.innerHTML="Grand Total<br/>"+funList}}var DataCells=trs[trs.length-1].childNodes;var GrandCellIndex=DataCells.length-1;var DataCellsArray=new Array();for(var k=0;k<=GrandCellIndex;k++){if(rowColumnHeaderCount<=k){var dataTd=DataCells[k].cloneNode();if(aggFunDataType==DataType.Amount&&aggFun!="count"){dataTd.innerHTML=amountSymbol+FormatData(emptyCellValue)}else{dataTd.innerHTML=FormatData(emptyCellValue)}if(k==GrandCellIndex){dataTd.setAttribute("class","GrandAgg DataCell")}else{dataTd.setAttribute("class","DataCell")}DataCellsArray.push(dataTd)}}var trsD=[];var rowid=0;var tr=TR.cloneNode();keys=RowSpanGroup.sortKeys();var prevLen=0;var len=0;var prevKey="";for(var key in keys){len=keys[key].split("--").length;if(rowid!=0&&rowid>=rowColumnHeaderCount){tbody.appendChild(tr);tr=TR.cloneNode();rowid=len-1}if(prevLen>len){var it=1;var rvalue=prevKey.split("--");for(var i=len;i<prevLen;i++){var td=TD.cloneNode();td.setAttribute("colspan",(rowColumnHeaderCount-prevLen+it));td.setAttribute("class","SubAgg");var value=rvalue.slice(0,(rowColumnHeaderCount-it)).join("--");td.setAttribute("rvalue",value);td.innerHTML=value.split("~~")[1]+" - "+funList;tr.appendChild(td);tbody.appendChild(tr);tr=TR.cloneNode();it++}}tr.appendChild(RowSpanGroup.items[keys[key]]);prevKey=keys[key];prevLen=len;rowid++}tbody.appendChild(tr);var rvalue=prevKey.split("--");var it=1;for(var i=0;i<prevLen;i++){var tr=TR.cloneNode();var td=TD.cloneNode();td.setAttribute("colspan",(rowColumnHeaderCount-prevLen+it));var value=rvalue.slice(0,(rowColumnHeaderCount-it)).join("--");if(i==prevLen-1){td.setAttribute("class","GrandAgg");td.innerHTML="Grand Total "+funList}else{td.setAttribute("class","SubAgg");td.innerHTML=value.split("~~")[1]+" - "+funList}td.setAttribute("rvalue",value);tr.appendChild(td);tbody.appendChild(tr);it++}var trs=tbody.childNodes;for(var i=0;i<trs.length;i++){if(i>=noOfHeaderRows){var td1=trs[i].lastChild;var subAggClass=td1.getAttribute("class");var rvalue=td1.getAttribute("rvalue");for(var k in DataCellsArray){var td1=DataCellsArray[k];var rv=td1.getAttribute("cvalue");rv=rv.replace(/rvalue/g,rvalue);var td=td1.cloneNode(true);if(rv==""){rv=container+"_GrandTotal"}td.setAttribute("id",rv);td.setAttribute("cvalue","");if(subAggClass=="SubAgg"||subAggClass=="GrandAgg"){td.setAttribute("class",subAggClass+" DataCell")}trs[i].appendChild(td)}}}table.appendChild(tbody);var doc=document.getElementById(container);if(that.IsLayoutEditable){$("#"+container).find("#EditButton").remove().end().append($("<div id='EditButton'>Edit Layout</div>"))}if(that.IsDataFilterable){$("#"+container).find("#FilterButton").remove().end().append($("<div id='FilterButton'>Filter Layout</div>"))}doc.innerHTML=doc.innerHTML+table.outerHTML;if(that.IsLayoutEditable){$("#EditButton").click(function(){GetOptionColumnList();DraggableColumns(true);$("#EditDialog").dialog("open")})}if(that.IsDataFilterable){$("#FilterButton").click(function(){GetFilterList();$("#FilterDialog").dialog("open")})}};var FillDataCells=function(dataArray){var groups=dataArray.Groups;var groupsCount=dataArray.GroupsCount;var Gtds=document.getElementById(container+"_GrandTotal");for(var i in groups){var count=parseInt(groupsCount[i]);setTimeout(function(){return},10);var $dataTd=document.getElementById(i);if($dataTd==null||$dataTd==="undefined"){continue}AggComputeFunction($dataTd,count,groups[i],aggFunLower);var values=i.split("**");var tmp=values[0].split("--");var ite=1;var gtd=document.getElementById(values[0]);AggComputeFunction(gtd,count,groups[i],aggFunLower);var tmpLen=tmp.length;while(ite<tmpLen){var cvalue=tmp.slice(0,tmp.length-ite).join("--");var tds=document.getElementById(cvalue+"**"+values[1]);AggComputeFunction(tds,count,groups[i],aggFunLower);tds=document.getElementById(cvalue);AggComputeFunction(tds,count,groups[i],aggFunLower);ite++}tds=document.getElementById("**"+values[1]);AggComputeFunction(tds,count,groups[i],aggFunLower);AggComputeFunction(Gtds,count,groups[i],aggFunLower)}};var AggComputeFunction=function(cellItem,count,newValue,aggFun){var data_count=cellItem.getAttribute("data-count");var data_val=cellItem.getAttribute("data-val");var c=0;var val=0;if(data_count!=null&&data_count!==undefined&&data_val!==undefined&&data_val!=null){c=data_count;val=data_val}var preVal;if(isNumeric(c)){count=count+parseInt(c)}if(!isNaN(val)){val=parseFloat(val)}switch(aggFun){case"sum":if(isNumeric(newValue)){val=val+parseFloat(newValue)}preVal=FormatData(val);break;case"max":if(isNaN(newValue)&&val==0){val=""}val=val<newValue?newValue:val;if(!isNaN(val)){preVal=FormatData(val)}else{preVal=val}break;case"min":if(isNaN(newValue)&&val==0){val=""}val=val==0||val>newValue?newValue:val;if(!isNaN(val)){preVal=FormatData(val)}else{preVal=val}break;case"avg":if(isNumeric(newValue)){val=val+parseFloat(newValue);if(count!=0){preVal=FormatData(val/count)}}else{preVal=FormatData(val)}break;case"count":val=parseFloat(count);preVal=(val);break;default:break}cellItem.setAttribute("data-count",count);cellItem.setAttribute("data-val",val);if(aggFunDataType==DataType.Amount&&aggFun!="count"){cellItem.innerHTML=amountSymbol+preVal}else{cellItem.innerHTML=preVal}};this.LoadingProgress=function(DomObjectId,show){var $domObject=$("#"+DomObjectId);if($domObject.length==0){$domObject=$("body")}$domObject.find("div.Loading").remove();if(show){var divLoading=$("<div class='Loading'>").html("<span><bold>Loading...</bold></span>");$domObject.append(divLoading)}};var ErrorDialog=function(DomObjectId,show,msg){that.LoadingProgress(DomObjectId,false);var $domObject=$("#"+DomObjectId);if($domObject.length==0){$domObject=$("body")}$domObject.find("div.Error").remove();if(show){var divLoading=$("<div Id='Error'>").html("<img src='styles/icons/error.gif'><span class='ErrorHeader'><bold>Error:</bold></span><br><span>"+msg+"</span>");$domObject.append(divLoading)}};function DraggableColumns(flag){$("td[field][cvalue]").mouseover(function(){$(this).parent().contents("td[field]").addClass("Heighlight")}).mouseout(function(){$(this).parent().contents("td[field]").removeClass("Heighlight")});$("td[field][rvalue]").mouseover(function(){var rvalue=$(this).attr("field");$('td[field = "'+rvalue+'"]').addClass("Heighlight")}).mouseout(function(){var rvalue=$(this).attr("field");$('td[field = "'+rvalue+'"]').removeClass("Heighlight")});$("#DataArea").droppable({addClasses:false,greedy:false,tolerance:"pointer",drop:function(event,ui){var dragged=ui.helper;if(dragged.attr("class").indexOf("func")>=0){var dataField=$("#DataArea").find("ul").find("li").first().text();dataField=dataField.split("(");dataField[0]=dragged.attr("field");dataField=dataField.join("(");var $li=$("<li field='"+dataField+"'>"+dataField+"</li>");$("#DataArea").find("ul").find("li").remove().end().append($li)}}});$("#ColumnDropdown").droppable({addClasses:false,greedy:false,tolerance:"pointer",drop:function(event,ui){var dragged=ui.helper.text();var $li=$("<li field='"+dragged+"'>"+dragged+"</li>");$("#ColumnSubmenu .ColumnList").append($li);$("#RowFieldList,#ColFieldList").find("li[field='"+dragged+"']").remove()}});$("#RowFieldList").find("ul").sortable({addclasses:false,connectWith:"#ColFieldList ul"}).disableSelection();$("#ColFieldList").find("ul").sortable({connectWith:"#RowFieldList ul"}).disableSelection();$(".ColumnList").sortable({connectWith:"#RowFieldList ul,#ColFieldList ul"}).disableSelection();$(".FunctionList").sortable({connectWith:"#DataArea ul"}).disableSelection()}var GetFilterList=function(){strDialog="<div id='FilterDialog'>";strDialog+="<div id='DialogHeader'><span>Filter Data</span></div>";strDialog+="<div id='FilterLayOut'>";strDialog+="<ul id='MainTabs'>";strDialog+="<li class='FilterHeader'><a href='#ColFields'><span>Column Area Fields</span></a></li>";strDialog+="<li class='FilterHeader'><a href='#RowFields'><span>Row Area Fields</span></a></li>";strDialog+="</ul>";strDialog+="<div id='ColFields'></div>";strDialog+="<div id='RowFields'></div>";strDialog+="</div>";strDialog+="<div id='FilterCancelButton'>Cancel</div><div id='FilterGoButton'>GO</div>";strDialog+=" </div>";$("#"+container).find("#FilterDialog").remove().end().append($(strDialog));$("#FilterLayOut").tabs();$("#FilterDialog").dialog({autoOpen:false,modal:true,width:800,maxHeight:600,maxWidth:800});$(".SubLayout").remove();var $sLayout=$("<div class='SubLayout'><ul></ul></div>");var $DivItem=$("<li class='FieldItem'><a href=''><span></span></a></li>");var $subLayout=$sLayout.clone();$("#ColFields").append($subLayout);var $sumMenu=$("<div class='FilterSubMenu'></div>");var $ol=$("<ol class='FilterValueList'></ol>");var $li=$("<li><input type=checkbox /> <span></span></li>");for(var colKey in colValueList){var div=$DivItem.clone();var sumMenu=$sumMenu.clone();sumMenu.attr("id",colKey);var ol=$ol.clone();div.find("span").text(colKey).end().find("a").attr("href","#"+colKey);$subLayout.find("ul").append(div);var ValueList=colValueList[colKey];var FilterValueList=ColumnFilterList[colKey];for(var innerKey in ValueList){var li=$li.clone();if(IsExistInArray(FilterValueList,ValueList[innerKey])){li.find("input").val(ValueList[innerKey]).attr("checked",true)}else{li.find("input").val(ValueList[innerKey]).attr("checked",false)}li.find("span").text(ValueList[innerKey]);ol.append(li)}if(ol.find("li").length>0){var li=$li.clone();li.find("span").text("Show All");li.find("input").val("-1").addClass("ShowAll");if(ol.find("li").length==ol.find("li input:checked").length){li.find("input").attr("checked",true)}else{li.find("input").attr("checked",false)}ol.prepend(li)}sumMenu.append(ol);$subLayout.append(sumMenu)}$subLayout.tabs();$subLayout=$sLayout.clone();$("#RowFields").append($subLayout);for(var rowKey in rowValueList){var div=$DivItem.clone();var sumMenu=$sumMenu.clone();sumMenu.attr("id",rowKey);var ol=$ol.clone();div.find("span").text(rowKey).end().find("a").attr("href","#"+rowKey);$subLayout.find("ul").append(div);var ValueList=rowValueList[rowKey];var FilterValueList=RowFilterList[rowKey];for(var innerKey in ValueList){var li=$li.clone();if(IsExistInArray(FilterValueList,ValueList[innerKey])){li.find("input").val(ValueList[innerKey]).attr("checked",true)}else{li.find("input").val(ValueList[innerKey]).attr("checked",false)}li.find("span").text(ValueList[innerKey]);ol.append(li)}if(ol.find("li").length>0){var li=$li.clone();li.find("span").text("Show All");li.find("input").val("-1").addClass("ShowAll");if(ol.find("li").length==ol.find("li input:checked").length){li.find("input").attr("checked",true)}else{li.find("input").attr("checked",false)}ol.prepend(li)}sumMenu.append(ol);$subLayout.append(sumMenu)}$subLayout.tabs();$(".FilterValueList").find("input.ShowAll").click(function(){if($(this).is(":checked")){$(this).parent().parent().find(":checkbox").attr("checked","checked")}else{$(this).parent().parent().find(":checkbox").removeAttr("checked")}});$(".FilterValueList").find("input:checkbox:not(.ShowAll)").click(function(){if($(this).is(":checked")&&$(this).parent().parent().find(":checkbox:not(.ShowAll)").length==$(this).parent().parent().find(":checkbox:checked").length){$(this).parent().parent().find(":checkbox.ShowAll").attr("checked","checked")}else{$(this).parent().parent().find(":checkbox.ShowAll").removeAttr("checked")}});$("#FilterGoButton").bind("click",function(){RowFilterList={};ColumnFilterList={};var $rowDivs=$("#RowFields").find(".FieldItem");$rowDivs.each(function(){var key=$(this).find("span").first().text();RowFilterList[key]=new Array();$("div#"+key).find("li input:checked").each(function(){if($(this).val!="-1"){RowFilterList[key].push($(this).val())}})});$rowDivs=$("#ColFields").find(".FieldItem");$rowDivs.each(function(){var key=$(this).find("span").first().text();ColumnFilterList[key]=new Array();$("div#"+key).find("li input:checked").each(function(){if($(this).val!="-1"){ColumnFilterList[key].push($(this).val())}})});RowSpanGroup=GetSpan(ResultAgg.GroupRowSpan,false);ColSpanGroup=GetSpan(ResultAgg.GroupColSpan,true);try{var containerDom=document.getElementById(container);var table=containerDom.getElementsByTagName("table");if(table.length){containerDom.removeChild(table[0])}CreateTableHeaders(ColSpanGroup,RowSpanGroup);if(that.ShowSubTotal==false){$("#report").find("TR TD.SubAgg").hide()}if(that.ShowGrandTotal==false){$("#report").find(".GrandAgg, .Header-GrandAgg").hide()}}catch(e){throw (e)}try{setTimeout(function(){FillDataCells(ResultAgg);that.LoadingProgress(container,false)},10)}catch(e){throw (e)}$("#FilterDialog").dialog("close");$("#FilterCancelButton").unbind("click");$(this).unbind("click");$("#"+container).find("#FilterDialog").remove();return false});$("#FilterCancelButton").bind("click",function(){$("#FilterDialog").dialog("close");$("#FilterDialog").dialog("close");$("#FilterGoButton").unbind("click");$(this).unbind("click");$("#"+container).find("#FilterDialog").remove();return false})};var GetOptionColumnList=function(){if(that.IsLayoutEditable){var strDialog="<div id='EditDialog' >";strDialog+="<div id='PopupHeader'><span>Edit Layout</span></div>";strDialog+="<div id='LayOut'>";strDialog+="<div id='MenuList'></div><div id='ColFieldList'><div class='FieldHeader'>Column Area</div></div><div id='RowFieldList'><div class='FieldHeader'>Row Area</div></div><div id='DataArea'><div class='FieldHeader'>Data Area</div></div>";strDialog+="</div>";strDialog+="<div id='CancelButton'>Cancel</div><div id='GoButton'>GO</div>";strDialog+="</div>";$("#"+container).find("#EditDialog").remove().end().append($(strDialog));$("#EditDialog").dialog({autoOpen:false,modal:true,resizable:false,width:375,maxHeight:400,maxWidth:600});var $olData=$("<ul></ul>");optInd=0;var Fields=funList.split(fieldSptr);while(optInd<Fields.length){var tmp=Fields[optInd];var $li=$("<li>"+tmp+"</li>");$olData.append($li);optInd++}$("#DataArea").find("ul").remove().end().append($olData);var $olCol=$("<ul></ul>");optInd=0;var Fields=colList.split(fieldSptr);while(optInd<Fields.length){var tmp=Fields[optInd];var $li=$("<li class='ui-state-highlight' field='"+tmp+"'>"+tmp+"</li>");$olCol.append($li);optInd++}$("#ColFieldList").find("ul").remove().end().append($olCol);var $olRow=$("<ul></ul>");optInd=0;var Fields=rowList.split(fieldSptr);while(optInd<Fields.length){var tmp=Fields[optInd];var $li=$("<li class='ui-state-highlight' field='"+tmp+"'>"+tmp+"</li>");$olRow.append($li);optInd++}$("#RowFieldList").find("ul").remove().end().append($olRow);var opt=optionList.split(fieldSptr);var optInd=0;var $ol=$("<ol class='ColumnList'></ol>");var $olfunc=$("<ol class='FunctionList'></ol>");while(optInd<opt.length&&opt!=""){var tmp=opt[optInd];var $li=$("<li field='"+tmp+"'>"+tmp+"</li>");$ol.append($li);optInd++}var $li1=("<li class='func' field='avg'>Average</li>");var $li2=("<li class='func' field='count'>Count</li>");var $li3=("<li class='func' field='max'>Maximum</li>");var $li4=("<li class='func' field='min'>Minimum</li>");var $li5=("<li class='func' field='sum'>Sum</li>");$olfunc.append($li1+$li2+$li3+$li4+$li5);$optOlDiv=$("<div id='FunctionSubmenu' ></div>").append($olfunc);$optDiv=$("<div id='FunctionDropdown'><div class='FunctionHeader' > </div></div>").append($optOlDiv);$("#MenuList").find("#FunctionDropdown").remove().end().append($optDiv);if(optInd>0){var $optOlDiv=$("<div id='ColumnSubmenu' ></div>").append($ol);var $optDiv=$("<div id='ColumnDropdown'><div class='ColumnHeader' > </div></div>").append($optOlDiv);$("#MenuList").find("#ColumnDropdown").remove().end().append($optDiv);$(".ColumnHeader").click(function(){$("#FunctionSubmenu").hide();$("#ColumnSubmenu").toggle()})}else{var $optDiv=$("<div id='ColumnDropdown'><div class='ColumnHeader' ></div></div>");$("#MenuList").find("#ColumnDropdown").remove().end().append($optDiv)}$(".FunctionHeader").click(function(){$("#ColumnSubmenu").hide();$("#FunctionSubmenu").toggle()});$(document).mouseup(function(){$("#ColumnSubmenu").hide();$("#FunctionSubmenu").hide()});$("#GoButton").bind("click",function(){try{var rowFieldLis=$("#RowFieldList ul li");if(rowFieldLis.length<=0){throw ("Row list can not be empty")}var colFieldLis=$("#ColFieldList ul li");if(colFieldLis.length<=0){throw ("Column list can not be empty")}var optionFieldLis=$("#ColumnSubmenu ol li");var dataFieldLiist=$("#DataArea ul li").first().text();var tempRowList="";rowFieldLis.each(function(){tempRowList+=fieldSptr+$(this).text()});tempRowList=tempRowList.substr(1,tempRowList.length-1);var tempColList="";colFieldLis.each(function(){tempColList+=fieldSptr+$(this).text()});tempColList=tempColList.substr(1,tempColList.length-1);var tempOptionList="";optionFieldLis.each(function(){tempOptionList+=fieldSptr+$(this).text()});tempOptionList=tempOptionList.substr(1,tempOptionList.length-1);$("#EditDialog").dialog("close");setTimeout(function(){$("#"+container).find("table").remove();that.LoadingProgress(container,true);colValueList={};rowValueList={};ColHeaderFields=null;RowHeaderFields=null;colList=tempColList;rowList=tempRowList;funList=dataFieldLiist;optionList=tempOptionList;IsChanged=true;that.Start()},1)}catch(e){ErrorDialog(container,true,e);return false}$("#CancelButton").unbind("click");$(this).unbind("click");$("#"+container).find("#EditDialog").remove()});$("#CancelButton").bind("click",function(){ColHeaderFields=null;RowHeaderFields=null;$("#EditDialog").dialog("close");$("#GoButton").unbind("click");$(this).unbind("click");$("#"+container).find("#EditDialog").remove()})}};$(document).ready(function(){});var ParseFilter=function(fieldList){var expr=fieldList;expr=expr.replace(/{'/g,"item.");expr=expr.replace(/}/g,"");expr=expr.replace(/','eq',/g,"==");expr=expr.replace(/','lt',/g,"<");expr=expr.replace(/','lteq',/g,"<=");expr=expr.replace(/','gt',/g,">");expr=expr.replace(/','gteq',/g,">=");return expr};var HashTable=function(obj){this.length=0;this.items={};this.setItem=function(key,value){this.items[key]=value};this.getItem=function(key){return this.hasItem(key)?this.items[key]:undefined};this.hasItem=function(key){return this.items.hasOwnProperty(key)};this.removeItem=function(key){if(this.hasItem(key)){previous=this.items[key];this.length--;delete this.items[key];return previous}else{return undefined}};this.keys=function(){var keys=[];for(var k in this.items){if(this.hasItem(k)){keys.push(k)}}return keys};this.sortKeys=function(){return this.keys().sort()};this.values=function(){var values=[];for(var k in this.items){if(this.hasItem(k)){values.push(this.items[k])}}return values};this.each=function(fn){for(var k in this.items){if(this.hasItem(k)){fn(k,this.items[k])}}};this.clear=function(){this.items={};this.length=0}};var clone=(function(){return function(obj){Clone.prototype=obj;return new Clone()};function Clone(){}}());var loadjscssfile=function(filename,filetype){if(filetype=="js"){var fileref=document.createElement("script");fileref.setAttribute("type","text/javascript");fileref.setAttribute("src",filename)}else{if(filetype=="css"){var fileref=document.createElement("link");fileref.setAttribute("rel","stylesheet");fileref.setAttribute("type","text/css");fileref.setAttribute("href",filename)}}if(typeof fileref!="undefined"){document.getElementsByTagName("head")[0].appendChild(fileref)}}};